<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dexter Solana Swap</title>
  <style>
    :root { color-scheme: dark; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { margin: 0; padding: 16px; background: transparent; color: #e2e8f0; }
    .swap-card { border: 1px solid rgba(148, 163, 184, 0.32); border-radius: 12px; padding: 18px; background: rgba(15, 23, 42, 0.55); display: grid; gap: 14px; }
    .swap-card__header { display: flex; justify-content: space-between; align-items: center; }
    .swap-card__title { margin: 0; font-size: 16px; font-weight: 600; }
    .badge { border-radius: 999px; padding: 4px 12px; font-size: 11px; background: rgba(96, 165, 250, 0.18); color: #93c5fd; text-transform: uppercase; letter-spacing: 0.08em; }
    .swap-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
    .field { display: flex; flex-direction: column; gap: 4px; }
    .field__label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.12em; color: #94a3b8; }
    .field__value { font-size: 13px; font-weight: 600; color: #f8fafc; word-break: break-all; }
    .field__value--secondary { color: #facc15; }
    .footer { font-size: 12px; color: #a5b4fc; }
    .footer .link { color: #c4b5fd; text-decoration: none; }
    .alert { padding: 12px; border-radius: 10px; border: 1px dashed rgba(248, 113, 113, 0.4); background: rgba(69, 10, 10, 0.4); color: #fecdd3; font-size: 12px; }
  </style>
</head>
<body>
  <script type="module">
    import { registerComponent } from "https://cdn.jsdelivr.net/npm/@openai/app-ui@latest";

    const format = (value, fallback = "—") => {
      if (value === null || value === undefined) return fallback;
      if (typeof value === "number") return value.toLocaleString();
      const text = String(value).trim();
      return text.length ? text : fallback;
    };

    const renderSwapCard = (title, data = {}, extra = {}) => {
      const badge = extra.badge || "Swap";
      const footer = extra.footer || "";
      const warning = extra.warning || null;

      const fields = [
        { label: "Input Mint", value: data.inputMint || data.input_mint },
        { label: "Output Mint", value: data.outputMint || data.output_mint },
        { label: "Amount In (UI)", value: data.amountUi || data.amount_ui },
        { label: "Expected Out (UI)", value: data.expectedOutputUi || data.expected_output_ui || data.desiredOutputUi },
        { label: "Slippage (bps)", value: data.slippageBps || data.slippage_bps },
        { label: "Wallet", value: data.walletAddress || data.wallet_address },
      ];

      const slotInfo = [
        { label: "Route", value: data.route || data.routeLabel },
        { label: "Price Impact (%)", value: data.priceImpactPct || data.priceImpact },
        { label: "Fee (SOL)", value: data.networkFeeSol || data.network_fee_sol },
        { label: "Quote Expiration", value: data.expiresAt || data.expiry },
      ];

      const metrics = [...fields, ...slotInfo].map(({ label, value }) => `
        <div class="field">
          <span class="field__label">${label}</span>
          <span class="field__value">${format(value)}</span>
        </div>
      `).join("");

      return `
        <article class="swap-card">
          <header class="swap-card__header">
            <h2 class="swap-card__title">${title}</h2>
            <span class="badge">${badge}</span>
          </header>
          <div class="swap-grid">
            ${metrics}
          </div>
          ${warning ? `<div class="alert">${warning}</div>` : ""}
          <footer class="footer">${footer}</footer>
        </article>
      `;
    };

    registerComponent("dexter-mcp/solana-swap-preview", (props = {}) => {
      const quote = props.result || props.quote || props;
      const warning = quote?.expired ? "Quote has expired. Fetch a fresh preview before executing." : null;
      return renderSwapCard("Swap Preview", quote, {
        badge: "Preview",
        warning,
        footer: `Quote ID: ${format(quote?.quoteId || quote?.id)} • Mode: ${format(quote?.mode)}`,
      });
    });

    registerComponent("dexter-mcp/solana-swap-execute", (props = {}) => {
      const execution = props.result || props.execution || props;
      const txId = execution?.txSignature || execution?.transactionSignature || execution?.signature;
      const footerParts = [
        `Swap ID: ${format(execution?.swapId)}`,
        txId ? `<a class="link" target="_blank" rel="noopener" href="https://solscan.io/tx/${txId}">View on Solscan</a>` : null,
      ].filter(Boolean);

      return renderSwapCard("Swap Execution", execution, {
        badge: "Executed",
        footer: footerParts.join(" • "),
      });
    });
  </script>
</body>
</html>
